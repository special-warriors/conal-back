<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <title>레포지토리 추가</title>
</head>
<body>
<h1>레포지토리 추가</h1>

<form th:action="@{|/users/${userId}/repositories|}" th:object="${repoRequest}" method="post">
  <input type="hidden" th:field="*{userId}" th:value="${userId}"/>

  <div>
    <label>레포지토리 이름:</label>
    <input type="text" th:field="*{name}" required/>
  </div>

  <div>
    <label>URL:</label>
    <input type="text" th:field="*{url}" required/>
  </div>

  <div>
    <label>종료일:</label>
    <input type="date" th:field="*{endDate}"/>
  </div>

  <div id="email-fields">
    <label>알림 이메일 (최대 5개):</label><br/>
    <input type="email" name="emails" class="email-input"/><br/>
  </div>
  <button type="button" onclick="addEmailField()">이메일 추가</button>

  <!-- 숨겨진 필드: 서버 전송용 -->
  <input type="hidden" name="emailsRaw" id="emailsRaw"/>

  <div>
    <button type="submit">등록</button>
    <a th:href="@{|/users/${userId}/repositories|}">
      <button type="button">취소</button>
    </a>
  </div>
</form>

<script>
  function addEmailField() {
    const container = document.getElementById('email-fields');
    const emailInputs = container.querySelectorAll('.email-input');
    if (emailInputs.length >= 5) {
      alert("이메일은 최대 5개까지 입력할 수 있습니다.");
      return;
    }
    const newInput = document.createElement('input');
    newInput.type = 'email';
    newInput.name = 'emails';
    newInput.classList.add('email-input');
    container.appendChild(document.createElement('br'));
    container.appendChild(newInput);
  }

  document.querySelector('form').addEventListener('submit', function () {
    const emails = Array.from(document.querySelectorAll('.email-input'))
    .map(e => e.value.trim())
    .filter(e => e.length > 0);
    document.getElementById('emailsRaw').value = emails.join(',');
  });
</script>

</body>
</html>